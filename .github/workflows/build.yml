name: Android CI - æž„å»ºæµ‹è¯•

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    
    - name: â˜• è®¾ç½®JDK 11
      uses: actions/setup-java@v4
      with:
        java-version: '11'
        distribution: 'temurin'
        cache: gradle
    
    - name: ðŸ”§ æŽˆäºˆgradlewæ‰§è¡Œæƒé™
      run: chmod +x gradlew
    
    - name: ðŸ—ï¸ å°è¯•æž„å»ºAndroidåº”ç”¨
      continue-on-error: true
      run: |
        echo "å¼€å§‹æž„å»º..."
        ./gradlew assembleDebug --stacktrace 2>&1 | tee build.log
        echo "æž„å»ºå‘½ä»¤æ‰§è¡Œå®Œæˆ"
    
    - name: ðŸ“‹ åˆ›å»ºè¯¦ç»†æ—¥å¿—æ–‡ä»¶
      if: always()
      run: |
        echo "========================================" > detailed_log.txt
        echo "Androidæž„å»ºå¤±è´¥è¯¦ç»†æ—¥å¿—" >> detailed_log.txt
        echo "========================================" >> detailed_log.txt
        echo "" >> detailed_log.txt
        echo "æž„å»ºæ—¶é—´: $(date)" >> detailed_log.txt
        echo "ä»“åº“: ${{ github.repository }}" >> detailed_log.txt
        echo "æäº¤: ${{ github.sha }}" >> detailed_log.txt
        echo "" >> detailed_log.txt
        echo "========================================" >> detailed_log.txt
        echo "ç¼–è¯‘é”™è¯¯è¾“å‡º:" >> detailed_log.txt
        echo "========================================" >> detailed_log.txt
        cat build.log >> detailed_log.txt || echo "æ— æ³•è¯»å–build.log" >> detailed_log.txt
        echo "" >> detailed_log.txt
        echo "========================================" >> detailed_log.txt
        echo "æ–‡ä»¶ç»“æž„:" >> detailed_log.txt
        echo "========================================" >> detailed_log.txt
        find . -type f -name "*.java" >> detailed_log.txt
        
    - name: ðŸ“¤ ä¸Šä¼ æž„å»ºæ—¥å¿—
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: build-logs
        path: |
          detailed_log.txt
          build.log
          **/*.log
        retention-days: 5
